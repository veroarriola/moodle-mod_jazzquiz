/**
 * @package   mod_jazzquiz
 * @author    Sebastian S. Gundersen <sebastsg@stud.ntnu.no>
 * @copyright 2014 University of Wisconsin - Madison
 * @copyright 2018 NTNU
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_jazzquiz/student",["jquery","mod_jazzquiz/core"],(function($,Jazz){const Quiz=Jazz.Quiz,Question=Jazz.Question,Ajax=Jazz.Ajax,setText=Jazz.setText;class Student{constructor(quiz){this.quiz=quiz,this.voteAnswer=void 0;let self=this;$(document).on("submit","#jazzquiz_question_form",(function(event){event.preventDefault(),self.submitAnswer()})).on("click","#jazzquiz_save_vote",(function(){self.saveVote()})).on("click",".jazzquiz-select-vote",(function(){self.voteAnswer=this.value}))}onNotRunning(data){setText(Quiz.info,"instructions_for_student")}onPreparing(data){setText(Quiz.info,"wait_for_instructor")}onRunning(data){if(this.quiz.question.isRunning)return;this.quiz.question.startCountdown(data.questiontime,data.delay)||setText(Quiz.info,"wait_for_instructor")}onReviewing(data){this.quiz.question.isVoteRunning=!1,this.quiz.question.isRunning=!1,this.quiz.question.hideTimer(),Quiz.hide(Question.box),setText(Quiz.info,"wait_for_instructor")}onSessionClosed(data){window.location=location.href.split("&")[0]}onVoting(data){if(this.quiz.question.isVoteRunning)return;Quiz.info.html(data.html),Quiz.show(Quiz.info);const options=data.options;for(let i=0;i<options.length;i++)Quiz.addMathjaxElement($("#"+options[i].content_id),options[i].text),"stack"===options[i].question_type&&Quiz.renderMaximaEquation(options[i].text,options[i].content_id);this.quiz.question.isVoteRunning=!0}onStateChange(state){}onQuestionTimerEnding(){}onTimerTick(timeLeft){setText(Question.timer,"question_will_end_in_x_seconds","jazzquiz",timeLeft)}onQuestionRefreshed(data){}submitAnswer(){if(this.quiz.question.isSaving)return;this.quiz.question.isSaving=!0,"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();const serialized=Question.form.serializeArray();let data={};for(let name in serialized)serialized.hasOwnProperty(name)&&(data[serialized[name].name]=serialized[name].value);Ajax.post("save_question",data,(data=>{data.feedback.length>0?Quiz.show(Quiz.info.html(data.feedback)):setText(Quiz.info,"wait_for_instructor"),this.quiz.question.isSaving=!1,this.quiz.question.isRunning&&(this.quiz.question.isVoteRunning||(Quiz.hide(Question.box),this.quiz.question.hideTimer()))})).fail((()=>{this.quiz.question.isSaving=!1}))}saveVote(){Ajax.post("save_vote",{vote:this.voteAnswer},(data=>{"success"===data.status?setText(Quiz.info,"wait_for_instructor"):setText(Quiz.info,"you_already_voted")}))}}return{initialize:()=>{new Quiz(Student).poll(2e3)}}}));

//# sourceMappingURL=student.min.js.map